##### Prometheus

##### Description

MongoDB  Prometheus-based plugin will fetch metrics and it will categories into different document types.

##### Configuration Settings

Below is the supported exporter 

*Docker Image*:  [bitnami/mongodb-exporter](https://github.com/dcu/mongodb_exporter)

Container configuration should take following command,

<div class="sfpollerExample">
<div>command:</div>
    <div class="innerLeft">
     <div>- sh</div>
     <div>- c</div>
     <div>- '/bin/mongodb_exporter --mongodb.uri mongodb:// ${MONGODB_ROOT_USERNAME}: ${MONGODB_ROOT_PASSWORD}@hostIP:hostPort/dbname'</div>
    </div>
</div>

It is recommended to create a dedicated user and attach the permission at least read only access all the databases and to pass in the mongodb URL securely, set the MONGODB_URL environment variable instead.

Kubernetes service needs to be created for exposing the default exporter port *9216*

##### Documents

Documents are categorized based on plugin type

Plugin contains the following document type

- **serverDetails** - collects server performance related metrics
- **databaseDetails** - collects database performance related metrics

These metrics has better visualization by applying the  **MongoDB_Kubernetes_Prometheus** template in dashboard



------



##### Logger

##### Description

Kubernetes Logger to monitor MongoDB  logs using centralized logging which collects general logs and slow query logs.

##### Prerequisites

Profiling needs to be enables to collect the slow query logs, this can be done by following the below steps,

**Set Profiling Level**

| **Level** | **Description**                                              |
| :-------: | ------------------------------------------------------------ |
|     0     | The profiler is off and does not collect any data. This is the default profiler level. |
|     1     | The profiler collects data for operations that take longer than the value of slowms. |
|     2     | The profiler collects data for all operations.               |

By default, the slow operation threshold is 100 milliseconds. To change the slow operation threshold, specify the desired threshold value 

```
db.setProfilingLevel(1, { slowms: 20 })
```

By default, sampleRate is set to 1.0, meaning all slow operations are profiled. When sampleRate is set between 0 and 1, databases with profiling level 1 will only profile a randomly sampled percentage of slow operations according to sampleRate.

```
db.setProfilingLevel(1, { slowms: 20, sampleRate: 0.42 })
```

**Get Profiling Status**

To view the profiling level, issue the following from the mongo shell,

```
db.getProfilingStatus()
```

***Note***: *When enabled, profiling has an effect on database performance, especially when configured with a profiling level of 2, or when using a low threshold value with a profiling level of 1. Profiling also consumes disk space, as it logs to both the system.profile collection and also the MongoDB logfile. Carefully consider any performance and security implications before configuring and enabling the profiler on a production deployment.*

For more Detailed Information about Profiling ,please visit [MongoDB](https://docs.mongodb.com/manual/tutorial/manage-the-database-profiler/) official page

##### Configuration Settings

Logs are collected through centralized logging. It requires Mongodb logs streaming to container stdout which can be done with the help of Busybox container with component label **mongodb**

##### Log Documents

Documents are categorized based on their type and can be viewed under logs section.

Plugin contains the following document type,

- **mongod-general** - collects all general logs generated by mongodb
- **mongod-slowquery** - collects all slow query which is executed in mongodb



##### Further Reading

[MySQL](../mysql/documentation.md) and [PostgreSQL](../postgres/documentation.md)  for other database related monitoring.

For help with plugins, please reach out to [support@snappyflow.io](mailto:support@snappyflow.io).
